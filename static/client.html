<!DOCTYPE HTML>
<html>
<head>
  <title>GS CodeReview NodeJS + WebSocket</title>
</head>
<body>
<link rel="stylesheet" type="text/css" href="/resources/css/bootstrap/bootstrap.min.css">
<script type="text/javascript" charset="utf-8" src="resources/js/jquery/jquery.min.js"></script>
<script type="text/javascript" charset="utf-8" src="resources/js/bootstrap/bootstrap.min.js"></script>

<div class="container">
    <div class="row">
        <div class="col-md-6 col-md-offset-3">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    <span class="glyphicon glyphicon-comment"></span> 노드 심플 채팅
                </div>
                <div class="panel-body">
                    <ul id="chatArea"> </ul>
                </div>
                <div class="panel-footer">
                    <div class="input-group">
                        <input id="messageText" type="text" class="form-control input-sm" placeholder="메시지 입력">
                        <span class="input-group-btn">
                            <button class="btn btn-warning btn-sm" id="submitBtn">
                                전송
                            </button>
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

</body>
<script>
$(document).ready(function(){
    btnEvent.init();
    webSocketEvent.init();
})

var btnEvent = { 
    init : function(){
        $('#submitBtn').on('click',function(){
            var msg = $('#messageText').val();
            webSocketEvent.send(msg);
            $('#messageText').val('');
        });
    }
}

var webSocketEvent = {
    ws : null,
    init : function(){
        this.ws = new WebSocket('ws://localhost:9999/ws');

        this.ws.onopen = function () {
            console.log('connect');
        };

        this.ws.onmessage = function (msg) {
            $('#chatArea').append($('<li>').html('message: ' + msg.data));
        };
        this.ws.onclose = function () {
           console.log("disconnect");
        };
        
    },
    send : function(message){
        this.ws.send(message);
    }
}

</script>
</html>